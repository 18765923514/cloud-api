# 智能模组直连接入平台
  模块直连接入平台是指设备采用智能模块的方式，接入到 U+ 平台，并通过 U+ 平台进行APP端与设备的交互，进而进行智能控制。

![图片][pic1]

## 基本功能

### 设备接入

&emsp;&emsp;添加/删除设备 
&emsp;&emsp;属性和报警上报 
&emsp;&emsp;设备自绑定
&emsp;&emsp;FOTA升级
&emsp;&emsp;数据上报

### 设备控制

&emsp;&emsp;设备入网
&emsp;&emsp;设备绑定
&emsp;&emsp;设备控制
&emsp;&emsp;状态变化主动上报
&emsp;&emsp;设备加密
&emsp;&emsp;OTA升级


## 开发文档

### **上电流程**

交互流程见下图：

![图片][pic2]

### 正常控制流程

**单命令控制流程**

交互流程见下图：

![图片][pic3]

**组命令控制流程**

交互流程见下图：

![图片][pic4]

### 主动汇报流程

**正常汇报流程**

交互流程见下图：

![图片][pic5]

**主动汇报重发流程** 

交互流程见下图：

![图片][pic6]

### 汇报配置流程 

**正常配置流程**

交互流程见下图：

![图片][pic7]

**配置时间不匹配流程**

交互流程见下图：

![图片][pic8]

**关闭主动汇报匹配流程**

交互流程见下图

![图片][pic9]

**恢复默认汇报间隔流程**

交互流程见下图：

![图片][pic10]

### 报警流程 

当网络家电设备的报警信息变化时，发送报警状态汇报帧给通信模块。通信模块接收到报警帧后，在限定的时间内(50ms)发送确认帧给网络家电设备。若网络家电设备未收到确认帧，则网络家电设备按照一定的时间间隔(300ms)重新发送报警信息，直到收到通信模块发送的确认帧。

如果在接到确认帧后的一段时间(5s)内，并没有解除警报(网络家电设备未接收到停止故障报警帧)，则继续以300ms间隔发送报警帧。

**正常报警流程**

交互流程见下图：

![图片][pic11]

**报警重发流程**

交互流程见下图：

![图片][pic12]

### 模块设置

**网络状态查询**

交互流程见下图：

![图片][pic13]

**进入设置模式**

设备发送模块进入设置模式帧，让模块进入设置模式。模块回复模块进入设置模式应答帧，进入设置模式。如模块无应答，设备重发2次模块进入设置模式帧，间隔300ms。

有显示能力的网络家电设备，在启动设置模块后(收到模块进入设置模式应答帧)可以进行相应的显示提示。

网络家电设备启动后可多次触发进入设置。

交互流程见下图：

![图片][pic14]

**退出设置模式**

模块进入设置模式后，超过预定时间还未配置完成或者在预定时间内的人为强制操作，设备向模块发送模块进入工作模式帧，强制模块退出配置模式。模块回复应答模块进入工作模式帧，进入正常工作模式。

交互流程见下图：

![图片][pic15]

**模块主动退出设置模式**

模块进入设置模式，超过预定时间还未设置完成，模块向设备发送主动汇报网络状态帧，退出设置模式。设备回复确认帧，根据网络状态帧进行状态显示。

模块进入设置模式后，如果模块设置完成，模块向设备发送主动汇报网络状态帧，退出设置模式。设备回复确认帧，根据网络状态帧进行状态显示。

交互流程见下图：

![图片][pic16]

## 蓝牙模块

### 蓝牙联动配对流程(网关侧)

**配对成功流程**

![图片][pic17]

**不允许配对流程**

交互流程见下图：

![图片][pic18]

**配对超时流程**

交互流程见下图：

![图片][pic19]

### 蓝牙解除联动配对流程(网关侧)

交互流程见下图：

![图片][pic20]

### 蓝牙配对流程(待配对侧)

交互流程见下图：

![图片][pic21]

### 联动流程(网关侧)

**联动上报流程**

交互流程见下图：

![图片][pic22]

 **联动控制流程**

交互流程见下图：

![图片][pic23]



历史图片

[pic1]:_media/_module/pic1.png
[pic2]:_media/_module/pic2.png
[pic3]:_media/_module/pic3.png
[pic4]:_media/_module/pic4.png
[pic5]:_media/_module/pic5.png
[pic6]:_media/_module/pic6.png
[pic7]:_media/_module/pic7.png
[pic8]:_media/_module/pic8.png
[pic9]:_media/_module/pic9.png
[pic10]:_media/_module/pic10.png
[pic11]:_media/_module/pic11.png
[pic12]:_media/_module/pic12.png
[pic13]:_media/_module/pic13.png
[pic14]:_media/_module/pic14.png
[pic15]:_media/_module/pic15.png
[pic16]:_media/_module/pic16.png
[pic17]:_media/_module/pic17.png
[pic18]:_media/_module/pic18.png
[pic19]:_media/_module/pic19.png
[pic20]:_media/_module/pic20.png
[pic21]:_media/_module/pic21.png
[pic22]:_media/_module/pic22.png
[pic23]:_media/_module/pic23.png
