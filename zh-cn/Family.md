!>  **当前版本**：[UWS 家庭模型服务 V1.5.0][family_document_url]  
 **发布时间**：2018-01-13 


### 简介

> 家庭模型服务实现的是一种以“家庭”为单位的智能互联设备共享组，使用此服务可以建立“家庭”组，在组下管理家庭成员及相关消息。

服务提供了创建/解散家庭、添加/删除家庭成员、邀请加入家庭及相关查询功能。可以在家庭组中进行设备共享与场景公用等操作。家庭成员（包括家庭创建者）可将自有设备分享到家庭，分享到家庭的设备，家庭成员自动具有控制权限，包含查看权，配置权，控制权等。


![家庭模型图片][family_type]

### 名词解释

### 功能介绍
**家庭的创建与成员管理**  
为了方便家庭用户进行一致性的管理，可以通过此模型创建“家庭组”，并将家庭相关人员加入到“家庭组”，“家庭组”中的用户可以贡献家庭智能设备与家庭场景。组成员发生变动可以删除或者用户主动退出“家庭组”。  
**家庭信息维护**  
此服务包括对家庭的整体操作（如创建家庭、修改家庭名称、删除家庭等）、家庭基础信息的维护操作（如查询家庭信息列表、修改家庭名称等）、家庭成员管理（如添加家庭成员、邀请家庭成员、查看家庭成员列表等），以及其他对于家庭的管理操作。  
**家庭设备共享与权限控制**  
使用此服务将设备分享给家庭成员，实现多人共享。同时，可以限制分享权限，实现对设备的访问的可控性，增强的设备的安全性。设备的权限被划分为查看，控制，配置权。控制过程中，会检查用户的权限。实际用户控制资源时，会把用户不同途径获取的访问权限进行综合计算用户的实际权限。操作设备过程中，用户如果没有权限，设备将会被禁止操作或无法看见。



## 接口清单  
### 公共结构  
- **AuthInfo**  
描述权限内容信息结构   
| **名称** | 权限内容信息，至少一项为true | AuthInfo ||    
| ------------- |:-------------:|:-----:|:-----:|  
|**字段名**|**类型**|**说明**|**备注**|  
|view|Boolean|是否有查看权||  
|set|Boolean|是否有配置权限||  
|control|Boolean|是否有控制权||    

- **QueryInfo**  
描述查询条件的接口 
| **名称** | 查询条件对象 | QueryInfo |  |     
| ------------- |:-------------:|:-----:|:-----:|    
|**字段名**|**类型**|**说明**|**备注**|  
|queryKey|String|查询关键字|mobile：手机，email：邮箱|  
|queryValue|String|关键字值|根据queryKey确定值|  
|accType|String|账号类型||  

- **QueryUserInfoResult**  
查询用户信息结果 
| **名称** | 查询用户信息结果对象 | QueryUserInfoResult |    
| ------------- |:-------------:|:-----:|:-----:|    
|**字段名**|**类型**|**说明**|**备注**|  
|mobile|String|用户手机号|可能为空，由用户信息是否完整决定|  
|email|String|电子邮件|可能为空，由用户信息是否完整决定|  
|userId|String|临时分配用户userid|不为空|  
|loginName|String|用户登录名（ids注册的登录名）|不为空|  

- **Permission**  
| 描述权限信息结构 | **名称** | 权限信息 | Permission | |
| ------------- |:-------------:|:-----:|:-----:|     
|**字段名**|**类型**|**说明**|**备注**|  
|auth|AuthInfo|权限内容||  
|authType|String|权限类型|home:家庭分享，share：个人分享，owner：设备主人，server：给appserver的权限|  


- **ShareDevice**  
描述设备的共享信息内容,包含设备分享到家庭的id,设备的属主,设备名字,分享权限集 
| **名称** | 设备共享信息 | ShareDevice |    
| ------------- |:-------------:|:-----:|  
|**字段名**|**类型**|**说明**|**备注**|  
|devInfo|DeviceBriefInfo|设备简明信息||  
|devName|String|设备名称||  
|devShareUser|UserBriefInfo|分享用户简明信息||  
|devFamilyId|String|设备所属家庭Id||  
|devOwner|UserBriefInfo|设备管理员简明信息||  
|permission|Permision|权限||   

- **FamilyInfo**  
描述家庭信息,包含家庭主人,家庭创建时间,家庭名称
| **名称** | 家庭信息 | FamilyInfo |    
| ------------- |:-------------:|:-----:|  
|**字段名**|**类型**|**说明**|**备注**|  
|familyId|String|家庭id，以字符串形式传递的Long型变量，会自动转换字符串为合适的整型|长度19|  
|familyName|String|家庭名称||  
|familyOwner|UserBriefInfo|家庭管理员用户简明信息||  
|appId|String|应用Id||  
|createtime|date|家庭创建时间||  

- **FamilyInfoOwnerName**  
描述家庭信息,包含家庭主人,家庭创建时间,家庭名称
| **名称** | 家庭信息,包含管理员的昵称 | FamilyInfoOwnerName |    
| ------------- |:-------------:|:-----:|  
|**字段名**|**类型**|**说明**|**备注**|  
|familyId|String|家庭id，以字符串形式传递的Long型变量，会自动转换字符串为合适的整型|长度19|  
|familyName|String|家庭名称||  
|familyOwner|UserBriefInfo|家庭管理员用户简明信息||  
|ownerName|String|家庭管理员用户简明信息||  
|appId|String|应用Id|| 
|createtime|date|应用Id|家庭创建时间|  

   
  




### 家庭基础服务
> API接口总览

| API名称        | 作用          | 是否开放  | 特别说明|  
| ------------- |:-------------:|:-----:|:-------------:|
| 家庭管理员创建家庭     | 用户创建家庭,在家庭模型管理平台中创建家庭,请求者作为家庭管理员,返回家庭的基础信息和错误码 | 是| 无| 
| 家庭管理员创建家庭带管理员昵称    | 用户创建家庭,在家庭模型管理平台中创建家庭,请求者作为家庭管理员,返回家庭的基础信息和错误码| 是| 无| 
| 家庭管理员修改家庭名称     | 用户修改拥有的家庭的名称，发送修改家庭信息消息给家庭成员,记录发送结果到日志 | 是| 无| 
| 家庭管理员或家庭成员查询家庭信息     | 家庭管理员或家庭成员查询家庭信息 | 是| 无| 
| 家庭管理员查询创建家庭信息列表     | 验证用户token,确认用户是否为家庭主人,查询家庭信息,并返回 | 是| 无| 
| 家庭成员查询加入的家庭信息列表     | 验证用户token,确认用户是否为家庭成员,查询加入的家庭信息,并返回 | 是| 无| 
| 家庭管理员删除家庭     | 家庭管理员删除家庭,收回用户分享给家庭的设备权限,收回家庭成员的家庭分享设备权限，向删除前家庭成员发送删除家庭消息，记录消息推送结果到日志 | 是| 无| 
| 家庭管理员添加家庭成员    | 家庭管理员添加家庭成员,分享家庭设备权限给成员，发送家庭成员添加家庭成员消息,支持memberId为临时的userid | 是| 无| 
| 家庭管理员邀请用户加入家庭     | 家庭管理员邀请用户加入家庭，并向用户下发推送邀请码, 支持targetId为临时的userid | 是| 无|  
| 家庭成员回复家庭管理员邀请     | 家庭成员接受家庭管理员邀请，加入家庭，
,分享家庭设备权限给成员，并发送添加家庭成员消息给家庭成员；如果拒绝，本次邀请结束，发送用户拒绝加入家庭消息到家庭管理员，记录消息推送结果到日志
 | 是| 无| 
| 家庭管理员或家庭成员修改家庭成员名称     | 家庭管理员修改家庭成员信息，其中包含家庭管理员在家庭中的昵称
家庭成员可以修改自己的信息，发送修改家庭成员信息消息给家庭成员，记录消息推送结果到日志
 | 是| 无| 
| 家庭管理员删除家庭成员     | 家庭主人删除家庭成员,并解除成员在家庭中分享的设备关系，并收回成员分享给家庭的设备，发送删除家庭成员消息给家庭全体成员，记录消息推送结果到日志 | 是| 无| 
| 家庭成员主动退出家庭     | 家庭成员主动退出家庭,撤销家庭成员的家庭设备分享,撤销其他家庭成员对本家庭成员设备的分享权限，向家庭其他成员发送删除家庭成员消息 | 是| 无| 
| 家庭管理员或家庭成员查询家庭成员     | 家庭管理员或家庭成员查询家庭成员 | 是| 无| 
| 家庭成员或家庭管理员查询家庭成员所有成员（包含管理员）     | 家庭管理员或家庭成员查询家庭成员 | 是| 无| 
| 根据关键字精确检索好友信息     | 精确查找用户信息，用于执行需要用户ID的场景，本次用户id有时效性，临时分配，有效期为1天，支持其他接口使用，在相关接口中有说明 | 是| 无| 

#### 家庭管理员创建家庭
> 用户创建家庭,在家庭模型管理平台中创建家庭,请求者作为家庭管理员,返回家庭的基础信息和错误码

##### 1、接口定义
?> **接入地 址：**  `/ufm/v1/protected/familyService/family `  
 **HTTP Method：** POST

**输入参数**  

| 参数名        | 类型          | 位置  | 必填|说明|
| ------------- |:-------------:|:-----:|:-------------:|
|  familyInfo    | FamilyInfo | Body| 必填|家庭信息|

**输出参数**  

|   名称      |     类型      | 位置  |必填 |说明|
| ------------- |:----------:|:-----:|:--------:|:---------:|
| familyInfo |  FamilyInfo  |   Body  |  必填  | 家庭信息 |

##### 2、请求样例  

**用户请求**
```java  
Header：
appId: MB-FRIDGEGENE1-0000
appVersion: 99.99.99.99990
clientId: 123
sequenceId: 2014022801010
accessToken: TGT1ANW5WCQ2SXRD2DGIYRRAVLOMS0
sign: e5bd9aefd68c16a9d441a636081f11ceaed51ff58ec608e5d90048f975927e7f
timestamp: 1491014447260 
language: zh-cn
timezone: +8
appKey: 6cdd4658b8e7dcedf287823b94eb6ff9
Content-Encoding: utf-8
Content-type: application/json
Body
{
    "aliasName": "s"
}

```  

**请求应答**

```java
{
    "retCode": "00000",
    "retInfo": "成功!"
}

```

##### 3、错误码  
> A00001、B00001、G20202、A00004、B00001、D00006

### 应用场景

### 使用方式

### 文档资料

### 常见问题


[^-^]:文本连接注释
[family_document_url]:#

[^-^]:常用图片注释
[family_type]:_media/_family/family_type.png
[family_liucheng]:_media/_family/family_liucheng.png



