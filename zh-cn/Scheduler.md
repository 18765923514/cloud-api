!>  **当前版本**：[UWS 预约定时 V1.0.0][scheduler_document_url]  
 **发布时间**：2018-07-19  
### 简介

为Haier U+云平台建立统一的定时预约服务，不同App均使用相同的预约服务定时操控设备。预约定时服务提供单任务预约执行与周期性任务的管理与设置，包括智能互联设备定时开关机、设备的模式设置、操作指令下发等控制能力。
通过统一的在云端建立定时执行任务,各应用之间使用统一的定时服务控制设备,避免了不同服务端对智能互联设备控制造成的冲突。
提供预约定时任务的新建、修改、删除与任务执行状态（启动、暂停）的管理。

![预约定时图片][scheduler_type]

### 功能介绍

**预约任务管理**
支持新建、修改或删除预约任务，用户通过设置预约事假周期、时间点、自动执行指令等创建和修改预约任务，对于同一台设备可以设定多条预约。
预约状态管理，预约任务分为启动与暂停两种状态，可根据使用需求进行状态开关设置。

**预约任务执行分析**
执行预览，为保证定时或周期性任务正确执行可对预约任务进行预览，即立即执行一次以预览相关控制指令设定效果。
查询与运行历史，已设定预约与历史执行情况，提供了查询接口可查看已有预约任务与其历史运行情况，包括运行时间、执行的操作、执行结果等数据。

### 接口清单

> API接口总览

| API名称        | 作用          | 是否开放  | 特别说明|
| ------------- |:-------------:|:-----:|:-------------:|
| 预约定时新增     | 适用于单设备单任务场景 | 是| 无|
| 预约定时批量新增  |适应于单设备批量定时和批量设备单定时场景 | 是| 无|
| 预约定时删除     | 将指定任务ID的预约定时设置为删除状态 | 是| 无|
| 预约定时修改     | 适用于单设备单任务场景 | 是| 无|
| 预约定时批量修改 | 适应于单设备批量定时和批量设备单定时场景 | 是| 无|
| 根据userid查询预约| 根据userId查询创建人或编辑人为自己预约（不做用户鉴权，有可能查到用户已取消分享的设备预约） | 是| 无|
| 根据deviceid查询预约| 根据deviceid查询预约详情 | 是| 无|
| 根据taskId查询预约| 根据taskid查询预约详情 | 是| 无|
| 预约定时执行日志查询| 预约定时执行日志查询 | 是| 无|
| 预约任务执行预览| 任务立即下发一次 | 是| 无|


#### 公共结构
**TaskInfo**

|名称	|预约定时任务信息|&emsp;|TaskInfo|
| ------------- |:-------------:|:-----:|:-------------:|
|字段名|	类型	|说明|	备注(数据字典描述，规范入参)|
|taskId	|String	|任务id|	varchar(50)
|taskName|	String	|任务名称|	varchar(50)
|schedulerType|	int	|预约类型（1=设备），此版本仅支持设备预约；|	int(2)|
|typeId|	String	|设备型号|	varchar(100)
|deviceId|	String	|设备mac	|varchar(50)
|appInfo|	appInfo[]	|应用信息 |	&emsp;|
|createUserInfo|	UserInfo[]	|创建者|	&emsp;|
|createTime|	dateTime	|创建时间: 日期时间类型的字符串|`yyyy-MM-dd hh:mm:ss`|
|modifyUserInfo|	UserInfo[]|	修改者	|&emsp;|
|modifyTime|	dateTime|	修改时间: 日期时间类型的字符串|`yyyy-MM-dd hh:mm:ss`|
|cron|	Cron[]|	cron对象	|&emsp;|
|endTime|	dateTime|	任务终止时间: 日期时间类型的字符串|`yyyy-MM-dd hh:mm:ss`|
|endTimeSource|	int	|endTime来源	|0: 系统默认，1:用户设置|
|argsInfo|	ArgsInfo[]	|指令	|&emsp;|
|status|	int|	定时预约状态 0 启用；1 已完成； 2 暂停；3 删除；4失效 |	int(2)|
|taskDesc|	String|	任务描述	|varchar(100)
|taskSeq|	int|	子任务序号id|	1：系统默认
|taskAmount|	int|	子任务总数|	&emsp;|

#### 预约定时新增




#### 预约定时批量新增



#### 预约定时删除




### 应用场景

预约定时任务应用于按照时间规则触发的自动化任务的执行的场景，包括对单个设备或多个设备单点预约、周期化任务预约，以及批量的多点预约任务。

> 1、  网器硬件本身不具备预约执行功能，通过云端服务能力，在APP、屏幕端、硬件端等提供预约执行能力。通过预约定时服务，设备端有能力接入API的可在设备端直接使用，设备端不具备的可在服务端进行使用预约服务能力，业务只需更关注提供用户的业务及服务，不用关心具体功能构建；

> 2、  同一设备，接入不同终端APP，且不同终端实现了不同预约逻辑，导致设备被不同业务触发调用，而用户又无统一入口查询其设备的所有预约列表，造成用户使用困扰。 如空调在优家APP、好空气APP端的预约信息；在接入统一的预约定时服务后，用户可在优家APP、好空气APP端查看到自己不同端配置的预约信息，方便用户管理使用预约控制功能；


### 使用方式

预约定时服务所提供的所有接口仅支持https协议请求，使用预约定时服务，需要在海极网注册成为开发者，参照接口文档配置相应的应用服务。
![开通流程][scheduler_liucheng]

### 文档资料

[预约定时接口服务][scheduler_document_url]

### 常见问题


[^-^]:文本连接注释
[scheduler_document_url]:_document/_scheduler/预约定时服务接口文档V1.0.0.docx


[^-^]:常用图片注释
[scheduler_type]:_media/_scheduler/scheduler_type.png
[scheduler_liucheng]:_media/_scheduler/scheduler_liucheng.png

